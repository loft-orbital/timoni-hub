tasks:
  gen:
    command:
      - '$workspaceRoot/tool/buildsystem/gen_cue.sh'
      - '$project'
    env:
      K8S_VERSION: '1.28'
    inputs:
      - /tool/buildsystem/gen_cue.sh
    outputs:
      - cue.mod/gen/**/*

  vendor:
    command:
      - '$workspaceRoot/tool/buildsystem/vendor_cue.sh'
      - '$project'
    deps:
      - '^:build'
    inputs:
      - /tool/buildsystem/vendor_cue.sh
    outputs:
      - cue.mod/pkg/**/*

  init:
    command: noop
    deps:
      - '~:vendor'
      - '~:gen'

  vet:
    command: '$workspaceRoot/tool/buildsystem/timoni_vet.sh'
    deps:
      - '~:init'
    inputs:
      - '/tool/buildsystem/timoni_vet.sh'
      - '@group(sources)'

  release:
    command:
      - '$workspaceRoot/tool/buildsystem/release-module.sh'
      - '$project'
    local: true # do not run with `moon check` or `moon ci`
    deps:
      - '^:release'
      - '~:init'
    inputs:
      - 'group(sources)'
      - /tool/buildsystem/release-module.sh
